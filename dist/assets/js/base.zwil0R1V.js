var C=(e=>(e.Local="local",e.Sync="sync",e.Managed="managed",e.Session="session",e))(C||{});async function l(e,o){function s(r){return typeof r=="function"}function n(r){return r instanceof Promise}return s(e)?n(e)?await e(o):e(o):e}let h=!1;function m(e){if(chrome.storage[e]===void 0)throw new Error(`Check your storage permission in manifest.json: ${e} is not defined`)}function _(e,o,s){let n=null,r=[];const a=(s==null?void 0:s.storageType)??"local",d=(s==null?void 0:s.liveUpdate)??!1;h===!1&&a==="session"&&(s==null?void 0:s.sessionAccessForContentScripts)===!0&&(m(a),chrome.storage[a].setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"}),h=!0);const u=async()=>(m(a),(await chrome.storage[a].get([e]))[e]??o),i=()=>{r.forEach(t=>t())},S=async t=>{n=await l(t,n),await chrome.storage[a].set({[e]:n}),i()},f=t=>(r=[...r,t],()=>{r=r.filter(c=>c!==t)}),w=()=>n;u().then(t=>{n=t,i()});async function v(t){if(t[e]===void 0)return;const c=t[e].newValue;n!==c&&(n=await l(c,n),i())}return d&&chrome.storage[a].onChanged.addListener(v),{get:u,set:S,getSnapshot:w,subscribe:f}}export{C as S,_ as c};
